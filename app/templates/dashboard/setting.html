{% extends "base.html" %}

{% block title %}Settings - AutoHire{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row">
        <div class="col-12">
            <h1 class="h3 mb-4 text-light">Settings</h1>
        </div>
    </div>
    
    <div class="row g-4">
        <!-- Profile Settings -->
        <div class="col-md-6 col-lg-4">
            <div class="card h-100 settings-card">
                <div class="card-body">
                    <div class="d-flex align-items-center mb-3">
                        <div class="settings-icon bg-primary">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="ms-3">
                            <h5 class="card-title mb-0 text-light">Profile Settings</h5>
                            <small class="text-light">Manage your personal information</small>
                        </div>
                    </div>
                    <p class="card-text text-light text-secondary link-light">
                        Update your personal details, contact information, skills, and professional experience.
                    </p>
                    <a href="{{ url_for('dashboard.profile') }}" class="btn btn-outline-primary">
                        <i class="fas fa-edit me-1"></i>Edit Profile
                    </a>
                </div>
            </div>
        </div>
        
        <!-- Platform Credentials -->
        <div class="col-md-6 col-lg-4">
            <div class="card h-100 settings-card">
                <div class="card-body">
                    <div class="d-flex align-items-center mb-3">
                        <div class="settings-icon bg-warning">
                            <i class="fas fa-key"></i>
                        </div>
                        <div class="ms-3">
                            <h5 class="card-title mb-0 text-light">Platform Credentials</h5>
                            <small class="text-light">Job platform login details</small>
                        </div>
                    </div>
                    <p class="card-text text-light">
                        Add or update your login credentials for LinkedIn, Indeed, Naukri, and InternShala.
                    </p>
                    <a href="{{ url_for('dashboard.platform_credentials') }}" class="btn btn-outline-warning">
                        <i class="fas fa-lock me-1"></i>Manage Credentials
                    </a>
                </div>
            </div>
        </div>
        
        <!-- Job Preferences -->
        <div class="col-md-6 col-lg-4">
            <div class="card h-100 settings-card">
                <div class="card-body">
                    <div class="d-flex align-items-center mb-3">
                        <div class="settings-icon bg-success">
                            <i class="fas fa-briefcase"></i>
                        </div>
                        <div class="ms-3">
                            <h5 class="card-title text-light mb-0">Job Preferences</h5>
                            <small class="text-light">Customize job search criteria</small>
                        </div>
                    </div>
                    <p class="card-text text-light">
                        Set your preferred job titles, locations, salary range, and platform priorities.
                    </p>
                    <a href="{{ url_for('dashboard.job_preferences') }}" class="btn btn-outline-success">
                        <i class="fas fa-cog me-1"></i>Set Preferences
                    </a>
                </div>
            </div>
        </div>
        
        <!-- Resume Management -->
        <div class="col-md-6 col-lg-4">
            <div class="card h-100 settings-card">
                <div class="card-body">
                    <div class="d-flex align-items-center mb-3">
                        <div class="settings-icon bg-info">
                            <i class="fas fa-file-alt"></i>
                        </div>
                        <div class="ms-3">
                            <h5 class="card-title mb-0 text-light">Resume Management</h5>
                            <small class="text-light">Upload and manage resumes</small>
                        </div>
                    </div>
                    <p class="card-text text-light">
                        Upload multiple resumes and let AutoHire choose the best one for each application.
                    </p>
                    <a href="{{ url_for('dashboard.resume_management') }}" class="btn btn-outline-info">
                        <i class="fas fa-upload me-1"></i>Manage Resumes
                    </a>
                </div>
            </div>
        </div>
        
        <!-- Change Password -->
        <div class="col-md-6 col-lg-4">
            <div class="card h-100 settings-card">
                <div class="card-body">
                    <div class="d-flex align-items-center mb-3">
                        <div class="settings-icon bg-danger">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <div class="ms-3">
                            <h5 class="card-title text-light mb-0">Security</h5>
                            <small class="text-light">Change password and security settings</small>
                        </div>
                    </div>
                    <p class="card-text text-light">
                        Update your password and manage account security settings.
                    </p>
                    <a href="{{ url_for('auth.change_password') }}" class="btn btn-outline-danger">
                        <i class="fas fa-key me-1"></i>Change Password
                    </a>
                </div>
            </div>
        </div>
        
        <!-- Analytics -->
        <div class="col-md-6 col-lg-4">
            <div class="card h-100 settings-card">
                <div class="card-body">
                    <div class="d-flex align-items-center mb-3">
                        <div class="settings-icon text-light bg-secondary">
                            <i class="fas fa-chart-bar"></i>
                        </div>
                        <div class="ms-3">
                            <h5 class="card-title text-light mb-0">Analytics & Reports</h5>
                            <small class="text-muted">View detailed statistics</small>
                        </div>
                    </div>
                    <p class="card-text text-light">
                        Access detailed analytics about your job applications and success rates.
                    </p>
                    <a href="{{ url_for('dashboard.analytics') }}" class="btn btn-outline-secondary">
                        <i class="fas fa-chart-line me-1"></i>View Analytics
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Account Actions -->
    <div class="row  mt-5">
        <div class="del-container col-12">
            <div class="card del-acc">
                <div class="card-header">
                    <h5 class="card-title text-danger mb-0">
                        <i class="fas fa-exclamation-triangle me-2"></i>Danger Zone
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <h6 class="fw-bold">Delete Account</h6>
                            <p class="text-light mb-0">
                                Once you delete your account, there is no going back. Please be certain.
                                All your data including applications history will be permanently deleted.
                            </p>
                        </div>
                        <div class="col-md-4 text-md-end">
                            <button class="btn btn-outline-danger" onclick="confirmDeleteAccount()">
                                <i class="fas fa-trash me-1"></i>Delete Account
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
.settings-card {
    background: rgb(40, 40, 40);
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    border: 1px solid rgba(0,0,0,0.1);
}

.settings-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
}

.settings-icon {
    width: 50px;
    height: 50px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1.25rem;
}

.card-body {
    padding: 1.5rem;
}

.btn {
    border-radius: 8px;
    padding: 0.5rem 1rem;
    transition: all 0.2s ease;
}

.btn:hover {
    transform: translateY(-1px);
}

.del-acc .card-header, .del-acc .card-body {
    background: rgb(40, 40, 40);
    color: white;
}

.del-acc .card-header {
    border-bottom: 1px solid rgba(255, 0, 0, 0.2);
}

.del-acc .card-body {
    border-bottom-left-radius: 10px;
    border-bottom-right-radius: 10px;
}

.del-container .card{
    background: black
}


</style>
{% endblock %}

<!-- Delete Account Confirmation Modal -->
<div class="modal fade" id="deleteAccountModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header border-0">
                <h5 class="modal-title text-danger">
                    <i class="fas fa-exclamation-triangle me-2"></i>Delete Account
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-danger border-0" role="alert">
                    <strong>Warning:</strong> This action cannot be undone!
                </div>
                <p class="mb-3">Are you absolutely sure you want to delete your account? This will permanently:</p>
                <ul class="text-muted mb-4">
                    <li>Delete all your job applications history</li>
                    <li>Remove all your resumes and preferences</li>
                    <li>Cancel any active automation processes</li>
                    <li>Permanently delete your profile data</li>
                </ul>
                <div class="mb-3">
                    <label class="form-label fw-bold">Type <code>DELETE</code> to confirm:</label>
                    <input type="text" class="form-control" id="deleteConfirmation" placeholder="Type DELETE here">
                </div>
                <div class="form-check mb-3">
                    <input class="form-check-input" type="checkbox" id="confirmDelete">
                    <label class="form-check-label" for="confirmDelete">
                        I understand that this action cannot be undone
                    </label>
                </div>
            </div>
            <div class="modal-footer border-0">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="finalDeleteBtn" disabled onclick="deleteAccount()">
                    <i class="fas fa-trash me-1"></i>Delete My Account
                </button>
            </div>
        </div>
    </div>
</div>

{% block extra_js %}
<script>
function confirmDeleteAccount() {
    const modal = new bootstrap.Modal(document.getElementById('deleteAccountModal'));
    modal.show();
}

// Enable delete button only when conditions are met
document.addEventListener('DOMContentLoaded', function() {
    const deleteInput = document.getElementById('deleteConfirmation');
    const confirmCheckbox = document.getElementById('confirmDelete');
    const deleteBtn = document.getElementById('finalDeleteBtn');
    
    function validateDeleteForm() {
        const isTextCorrect = deleteInput.value.trim() === 'DELETE';
        const isChecked = confirmCheckbox.checked;
        deleteBtn.disabled = !(isTextCorrect && isChecked);
    }
    
    deleteInput.addEventListener('input', validateDeleteForm);
    confirmCheckbox.addEventListener('change', validateDeleteForm);
});

function deleteAccount() {
    const form = document.createElement('form');
    form.method = 'POST';
    form.action = '{{ url_for("auth.delete_account") }}';
    
    // Add CSRF token
    const csrfToken = document.querySelector('meta[name=csrf-token]');
    if (csrfToken) {
        const csrfInput = document.createElement('input');
        csrfInput.type = 'hidden';
        csrfInput.name = 'csrf_token';
        csrfInput.value = csrfToken.content;
        form.appendChild(csrfInput);
    }
    
    document.body.appendChild(form);
    form.submit();
}
</script>
{% endblock %}
