{% extends "base.html" %}

{% block title %}Resume Management - AutoHire{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h1 class="h3 mb-0">Resume Management</h1>
                    <p class="text-muted mb-0">Upload and manage your resumes for job applications</p>
                </div>
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#uploadResumeModal">
                    <i class="fas fa-upload me-1"></i>Upload Resume
                </button>
            </div>
        </div>
    </div>

    <!-- Resume Stats -->
    <div class="row g-4 mb-4">
        <div class="col-xl-3 col-md-6">
            <div class="card stats-card border-0 h-100">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="stats-icon bg-primary">
                            <i class="fas fa-file-pdf text-white"></i>
                        </div>
                        <div class="ms-3">
                            <h2 class="h4 mb-0 fw-bold">0</h2>
                            <p class="text-muted mb-0">Total Resumes</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-xl-3 col-md-6">
            <div class="card stats-card border-0 h-100">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="stats-icon bg-success">
                            <i class="fas fa-star text-white"></i>
                        </div>
                        <div class="ms-3">
                            <h2 class="h4 mb-0 fw-bold">0</h2>
                            <p class="text-muted mb-0">Primary Resume</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-xl-3 col-md-6">
            <div class="card stats-card border-0 h-100">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="stats-icon bg-info">
                            <i class="fas fa-paper-plane text-white"></i>
                        </div>
                        <div class="ms-3">
                            <h2 class="h4 mb-0 fw-bold">0</h2>
                            <p class="text-muted mb-0">Times Used</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-xl-3 col-md-6">
            <div class="card stats-card border-0 h-100">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="stats-icon bg-warning">
                            <i class="fas fa-percentage text-white"></i>
                        </div>
                        <div class="ms-3">
                            <h2 class="h4 mb-0 fw-bold">0%</h2>
                            <p class="text-muted mb-0">Success Rate</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Resume List -->
    <div class="row">
        <div class="col-12">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-transparent border-0 d-flex justify-content-between align-items-center">
                    <div class="d-flex align-items-center">
                        <i class="fas fa-folder-open text-primary me-2"></i>
                        <h5 class="card-title mb-0">Your Resumes</h5>
                    </div>
                    <div class="d-flex align-items-center">
                        <div class="input-group input-group-sm me-3" style="width: 250px;">
                            <span class="input-group-text">
                                <i class="fas fa-search"></i>
                            </span>
                            <input type="text" class="form-control" placeholder="Search resumes..." id="searchResumes">
                        </div>
                        <div class="dropdown">
                            <button class="btn btn-outline-secondary btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                <i class="fas fa-filter me-1"></i>Filter
                            </button>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#" onclick="filterResumes('all')">All Resumes</a></li>
                                <li><a class="dropdown-item" href="#" onclick="filterResumes('primary')">Primary Only</a></li>
                                <li><a class="dropdown-item" href="#" onclick="filterResumes('active')">Active Only</a></li>
                                <li><a class="dropdown-item" href="#" onclick="filterResumes('inactive')">Inactive</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="card-body p-0">
                    <!-- No Resumes State -->
                    <div class="empty-state text-center py-5" id="emptyState">
                        <i class="fas fa-file-pdf fa-4x text-muted mb-3"></i>
                        <h5 class="text-muted mb-2">No resumes uploaded yet</h5>
                        <p class="text-muted mb-4">Upload your first resume to start applying for jobs automatically</p>
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#uploadResumeModal">
                            <i class="fas fa-upload me-2"></i>Upload Your First Resume
                        </button>
                        
                        <div class="row justify-content-center mt-5">
                            <div class="col-md-8">
                                <div class="alert alert-light border" role="alert">
                                    <h6 class="alert-heading">
                                        <i class="fas fa-lightbulb text-warning me-2"></i>Tips for uploading resumes:
                                    </h6>
                                    <ul class="mb-0 text-start">
                                        <li>Use PDF format for best compatibility</li>
                                        <li>Keep file size under 5MB</li>
                                        <li>Use clear, descriptive names</li>
                                        <li>Set one resume as primary for default use</li>
                                        <li>Upload different versions for different job types</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Resume Table (Hidden by default, shown when resumes exist) -->
                    <div class="table-responsive d-none" id="resumeTable">
                        <table class="table table-hover mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th>Resume Name</th>
                                    <th>File Name</th>
                                    <th>Type</th>
                                    <th>Size</th>
                                    <th>Status</th>
                                    <th>Used</th>
                                    <th>Success Rate</th>
                                    <th>Uploaded</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="resumeTableBody">
                                <!-- Dynamic content will be inserted here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Upload Resume Modal -->
<div class="modal fade" id="uploadResumeModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <div class="d-flex align-items-center">
                    <i class="fas fa-upload text-primary me-2"></i>
                    <h5 class="modal-title">Upload Resume</h5>
                </div>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="uploadResumeForm" enctype="multipart/form-data">
                    <div class="row g-3">
                        <div class="col-12">
                            <label class="form-label fw-bold">Resume File</label>
                            <div class="upload-area" id="uploadArea">
                                <div class="upload-content">
                                    <i class="fas fa-cloud-upload-alt fa-3x text-muted mb-3"></i>
                                    <h6 class="text-muted">Drag and drop your resume here</h6>
                                    <p class="text-muted small mb-3">or click to browse files</p>
                                    <input type="file" class="form-control d-none" id="resumeFile" name="resume" accept=".pdf,.doc,.docx">
                                    <button type="button" class="btn btn-outline-primary" onclick="document.getElementById('resumeFile').click()">
                                        <i class="fas fa-folder-open me-1"></i>Browse Files
                                    </button>
                                </div>
                            </div>
                            <div class="form-text">Accepted formats: PDF, DOC, DOCX. Maximum size: 5MB</div>
                        </div>

                        <div class="col-12">
                            <label for="resumeName" class="form-label fw-bold">Resume Name</label>
                            <input type="text" class="form-control" id="resumeName" name="resume_name" 
                                   placeholder="e.g., Software Engineer Resume - 2025" required>
                            <div class="form-text">Give your resume a descriptive name for easy identification</div>
                        </div>

                        <div class="col-md-6">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="setPrimary" name="set_primary">
                                <label class="form-check-label fw-bold" for="setPrimary">
                                    Set as Primary Resume
                                </label>
                                <div class="form-text">Primary resume is used by default for applications</div>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="isActive" name="is_active" checked>
                                <label class="form-check-label fw-bold" for="isActive">
                                    Active Resume
                                </label>
                                <div class="form-text">Only active resumes are used for applications</div>
                            </div>
                        </div>
                    </div>

                    <div class="upload-progress mt-3 d-none">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span class="text-muted">Uploading...</span>
                            <span class="text-muted" id="uploadPercent">0%</span>
                        </div>
                        <div class="progress">
                            <div class="progress-bar" role="progressbar" style="width: 0%" id="uploadProgressBar"></div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="uploadResume()">
                    <i class="fas fa-upload me-1"></i>Upload Resume
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Resume Actions Modal -->
<div class="modal fade" id="resumeActionsModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Resume Actions</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="d-grid gap-2">
                    <button class="btn btn-outline-primary" onclick="downloadResume()">
                        <i class="fas fa-download me-2"></i>Download
                    </button>
                    <button class="btn btn-outline-success" onclick="setPrimaryResume()">
                        <i class="fas fa-star me-2"></i>Set as Primary
                    </button>
                    <button class="btn btn-outline-info" onclick="toggleResumeStatus()">
                        <i class="fas fa-toggle-on me-2"></i>Toggle Active Status
                    </button>
                    <button class="btn btn-outline-warning" onclick="editResumeName()">
                        <i class="fas fa-edit me-2"></i>Edit Name
                    </button>
                    <hr>
                    <button class="btn btn-outline-danger" onclick="deleteResume()">
                        <i class="fas fa-trash me-2"></i>Delete Resume
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
.stats-card {
    background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.07);
    transition: transform 0.2s ease;
}

.stats-card:hover {
    transform: translateY(-2px);
}

.stats-icon {
    width: 60px;
    height: 60px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
}

.upload-area {
    border: 2px dashed #dee2e6;
    border-radius: 12px;
    padding: 40px 20px;
    text-align: center;
    transition: all 0.3s ease;
    cursor: pointer;
}

.upload-area:hover {
    border-color: #0d6efd;
    background-color: #f8f9ff;
}

.upload-area.dragover {
    border-color: #0d6efd;
    background-color: #f8f9ff;
    transform: scale(1.02);
}

.card {
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.07);
}

.table th {
    font-weight: 600;
    border-bottom: 2px solid #dee2e6;
}

.badge-primary-resume {
    background-color: #ffc107;
    color: #000;
}

.badge-active {
    background-color: #28a745;
    color: white;
}

.badge-inactive {
    background-color: #6c757d;
    color: white;
}

.empty-state {
    min-height: 400px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}

.upload-progress {
    background: #f8f9fa;
    padding: 15px;
    border-radius: 8px;
    border: 1px solid #e9ecef;
}
</style>
{% endblock %}

{% block extra_js %}
<script>
let selectedResumeId = null;

// File upload handling
document.getElementById('resumeFile').addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (file) {
        handleFileSelect(file);
    }
});

// Drag and drop handling
const uploadArea = document.getElementById('uploadArea');
uploadArea.addEventListener('dragover', function(e) {
    e.preventDefault();
    this.classList.add('dragover');
});

uploadArea.addEventListener('dragleave', function(e) {
    e.preventDefault();
    this.classList.remove('dragover');
});

uploadArea.addEventListener('drop', function(e) {
    e.preventDefault();
    this.classList.remove('dragover');
    const files = e.dataTransfer.files;
    if (files.length > 0) {
        document.getElementById('resumeFile').files = files;
        handleFileSelect(files[0]);
    }
});

function handleFileSelect(file) {
    const fileName = file.name;
    const fileSize = (file.size / 1024 / 1024).toFixed(2);
    
    // Validate file type
    const allowedTypes = ['application/pdf', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'];
    if (!allowedTypes.includes(file.type)) {
        alert('Please upload a PDF, DOC, or DOCX file.');
        return;
    }
    
    // Validate file size (5MB limit)
    if (file.size > 5 * 1024 * 1024) {
        alert('File size must be less than 5MB.');
        return;
    }
    
    // Update UI
    const uploadContent = uploadArea.querySelector('.upload-content');
    uploadContent.innerHTML = `
        <i class="fas fa-file-pdf fa-3x text-success mb-3"></i>
        <h6 class="text-success">${fileName}</h6>
        <p class="text-muted small">Size: ${fileSize} MB</p>
        <button type="button" class="btn btn-outline-secondary btn-sm" onclick="clearFileSelection()">
            <i class="fas fa-times me-1"></i>Remove
        </button>
    `;
    
    // Auto-fill resume name
    const baseName = fileName.replace(/\.[^/.]+$/, "");
    document.getElementById('resumeName').value = baseName;
}

function clearFileSelection() {
    document.getElementById('resumeFile').value = '';
    const uploadContent = uploadArea.querySelector('.upload-content');
    uploadContent.innerHTML = `
        <i class="fas fa-cloud-upload-alt fa-3x text-muted mb-3"></i>
        <h6 class="text-muted">Drag and drop your resume here</h6>
        <p class="text-muted small mb-3">or click to browse files</p>
        <button type="button" class="btn btn-outline-primary" onclick="document.getElementById('resumeFile').click()">
            <i class="fas fa-folder-open me-1"></i>Browse Files
        </button>
    `;
    document.getElementById('resumeName').value = '';
}

function uploadResume() {
    const form = document.getElementById('uploadResumeForm');
    const formData = new FormData(form);
    
    // Validate required fields
    if (!document.getElementById('resumeFile').files[0]) {
        alert('Please select a file to upload.');
        return;
    }
    
    if (!document.getElementById('resumeName').value.trim()) {
        alert('Please enter a resume name.');
        return;
    }
    
    // Show progress
    const progressDiv = document.querySelector('.upload-progress');
    progressDiv.classList.remove('d-none');
    
    // Simulate upload progress (replace with actual upload logic)
    let progress = 0;
    const progressBar = document.getElementById('uploadProgressBar');
    const progressPercent = document.getElementById('uploadPercent');
    
    const interval = setInterval(() => {
        progress += 10;
        progressBar.style.width = progress + '%';
        progressPercent.textContent = progress + '%';
        
        if (progress >= 100) {
            clearInterval(interval);
            setTimeout(() => {
                alert('Resume uploaded successfully!');
                bootstrap.Modal.getInstance(document.getElementById('uploadResumeModal')).hide();
                progressDiv.classList.add('d-none');
                progressBar.style.width = '0%';
                progressPercent.textContent = '0%';
                form.reset();
                clearFileSelection();
                // Refresh the page or update the resume list
                location.reload();
            }, 500);
        }
    }, 200);
}

function filterResumes(filter) {
    // Implementation for filtering resumes
    console.log('Filtering by:', filter);
}

function searchResumes() {
    const searchTerm = document.getElementById('searchResumes').value.toLowerCase();
    // Implementation for searching resumes
    console.log('Searching for:', searchTerm);
}

// Resume action functions
function downloadResume() {
    console.log('Downloading resume:', selectedResumeId);
    bootstrap.Modal.getInstance(document.getElementById('resumeActionsModal')).hide();
}

function setPrimaryResume() {
    console.log('Setting primary resume:', selectedResumeId);
    bootstrap.Modal.getInstance(document.getElementById('resumeActionsModal')).hide();
}

function toggleResumeStatus() {
    console.log('Toggling status for resume:', selectedResumeId);
    bootstrap.Modal.getInstance(document.getElementById('resumeActionsModal')).hide();
}

function editResumeName() {
    const newName = prompt('Enter new resume name:');
    if (newName && newName.trim()) {
        console.log('Editing resume name:', selectedResumeId, newName);
    }
    bootstrap.Modal.getInstance(document.getElementById('resumeActionsModal')).hide();
}

function deleteResume() {
    if (confirm('Are you sure you want to delete this resume? This action cannot be undone.')) {
        console.log('Deleting resume:', selectedResumeId);
    }
    bootstrap.Modal.getInstance(document.getElementById('resumeActionsModal')).hide();
}

// Search functionality
document.getElementById('searchResumes').addEventListener('input', searchResumes);
</script>
{% endblock %}
